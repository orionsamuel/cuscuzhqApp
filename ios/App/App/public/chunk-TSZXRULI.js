import{b as ce}from"./chunk-77ZGE33G.js";import{a as ae}from"./chunk-MONBQXQC.js";import{a as u}from"./chunk-WNQ4N7RJ.js";import{A as E,Bb as re,D as f,Da as A,E as p,Ea as U,F as m,Fa as j,G as y,Ga as D,K as S,L as C,M as _,T as F,V as w,W as P,Za as N,ba as k,da as z,ea as $,eb as L,fb as B,ga as R,gb as H,hb as W,i as T,ib as Z,ja as v,jb as q,k as l,kb as G,lb as J,m as x,mb as K,n as b,na as V,nb as Q,ob as X,rb as Y,s as M,sb as ee,tb as te,u as d,vb as ie,x as O,yb as oe,zb as ne}from"./chunk-SXNL5ZVY.js";import"./chunk-UAS5NDXO.js";import{b as se}from"./chunk-MHFFHBR2.js";import"./chunk-77S4VQ5A.js";import"./chunk-NY5B3PCS.js";import"./chunk-XWEC3AQS.js";import"./chunk-73IIU4GO.js";import"./chunk-U6X5N3E5.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-NMPY7VJP.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{f as c}from"./chunk-S5EYVFES.js";function me(o){o.CapacitorUtils.Synapse=new Proxy({},{get(r,a){return new Proxy({},{get(t,e){return(i,n,s)=>{let h=o.Capacitor.Plugins[a];if(h===void 0){s(new Error(`Capacitor plugin ${a} not found`));return}if(typeof h[e]!="function"){s(new Error(`Method ${e} not found in Capacitor plugin ${a}`));return}c(null,null,function*(){try{let I=yield h[e](i);n(I)}catch(I){s(I)}})}}})}})}function de(o){o.CapacitorUtils.Synapse=new Proxy({},{get(r,a){return o.cordova.plugins[a]}})}function le(o=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!o?me(window):window.cordova!==void 0&&de(window))}var g=se("Filesystem",{web:()=>import("./chunk-KCK533QP.js").then(o=>new o.FilesystemWeb)});le();var pe=(()=>{let r=class r{constructor(){this.http=l(v)}cacheImage(t,e){return c(this,null,function*(){let i=this.getFileName(e);try{try{let n=yield g.readFile({path:i,directory:u.Cache});return console.log("Image from cache:",i),`data:image/jpeg;base64,${n.data}`}catch{console.log("Downloading image:",t);let s=yield this.http.get(t,{responseType:"blob"}).toPromise();if(!s)throw new Error("Empty response");let h=yield this.blobToBase64(s);return yield g.writeFile({path:i,data:h,directory:u.Cache,recursive:!0}),console.log("Image saved to cache:",i),`data:image/jpeg;base64,${h}`}}catch(n){return console.error("Error in cacheImage:",n),t}})}getFileName(t){return`cache_${t.replace(/[^a-zA-Z0-9]/g,"_")}.jpg`}blobToBase64(t){return new Promise((e,i)=>{let n=new FileReader;n.onload=()=>{let s=n.result,h=s.split(",")[1];e(h||s)},n.onerror=i,n.readAsDataURL(t)})}isImageCached(t){return c(this,null,function*(){try{let e=this.getFileName(t);return yield g.stat({path:e,directory:u.Cache}),!0}catch{return!1}})}removeFromCache(t){return c(this,null,function*(){try{let e=this.getFileName(t);yield g.deleteFile({path:e,directory:u.Cache}),console.log("Removed from cache:",e)}catch(e){console.warn("Error removing from cache:",e)}})}clearCache(){return c(this,null,function*(){try{let e=(yield g.readdir({path:"",directory:u.Cache})).files.filter(i=>i.name.startsWith("cache_"));for(let i of e)yield g.deleteFile({path:i.name,directory:u.Cache});console.log("Cache cleared successfully")}catch(t){console.error("Error clearing cache:",t)}})}getCacheSize(){return c(this,null,function*(){try{let t=yield g.readdir({path:"",directory:u.Cache}),e=0,i=t.files.filter(n=>n.name.startsWith("cache_"));for(let n of i){let s=yield g.stat({path:n.name,directory:u.Cache});e+=s.size||0}return e}catch(t){return console.error("Error getting cache size:",t),0}})}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();function ge(o,r){o&1&&(p(0,"div",10),y(1,"ion-spinner",11),p(2,"p"),w(3,"Atualizando..."),m()())}function he(o,r){if(o&1){let a=S();p(0,"ion-item-sliding",14,0)(2,"ion-item",15),C("click",function(){let e=x(a).$implicit,i=_(2);return b(i.abrirParticipante(e))}),p(3,"ion-thumbnail",16),C("click",function(){let e=x(a).$implicit,i=_(2);return b(i.abrirParticipante(e))}),y(4,"img",17),m(),p(5,"ion-label",18)(6,"div")(7,"h2"),w(8),m(),p(9,"p"),w(10),m()()(),p(11,"div",19)(12,"ion-button",20),C("click",function(e){let i=x(a).$implicit;return _(2).toggleAudio(i.id,i.som),b(e.stopPropagation())}),y(13,"ion-icon",21),m(),p(14,"ion-button",20),C("click",function(e){let i=x(a).$implicit;return _(2).pararAudio(i.id),b(e.stopPropagation())}),y(15,"ion-icon",22),m()()(),p(16,"ion-item-options",23)(17,"ion-item-option",24),C("click",function(){let e=x(a).$implicit,i=F(1),n=_(2);return b(n.excluirParticipante(i,e))}),y(18,"ion-icon",25),m()()()}if(o&2){let a=r.$implicit,t=_(2);d(4),f("src",t.getImageUrl(a),M)("alt",a.personagem),d(4),P(a.nome),d(2),P(a.personagem),d(3),f("name",t.players[a.id]!=null&&t.players[a.id].isPlaying?"pause":"play")}}function fe(o,r){if(o&1&&(p(0,"ion-list",12),E(1,he,19,5,"ion-item-sliding",13),m()),o&2){let a=_();d(),f("ngForOf",a.listaParticipantes)}}var De=(()=>{let r=class r{constructor(){this.alertController=l(oe),this.formBuilder=l(A),this.http=l(v),this.cospobreService=l(ce),this.inscritosService=l(ae),this.imageCacheService=l(pe),this.toastController=l(ne),this.router=l(V),this.platform=l(D),this.cdr=l(k),this.titulo="Cospobres",this.isCosplay=!0,this.notas={},this.cachedImages={},this.isLoading=!1,this.players={},this.platform.ready().then(()=>{this.init()})}ngOnInit(){}ionViewDidEnter(){this.cdr.detectChanges()}init(){return c(this,null,function*(){this.isLoading=!0;try{yield this.buscarEdicao(),yield this.buscarParticipante(),yield this.cacheImagesForParticipants()}catch(t){console.error("Erro ao inicializar dados:",t)}finally{this.isLoading=!1}})}cacheImagesForParticipants(){return c(this,null,function*(){try{for(let t of this.listaParticipantes){let e=yield this.imageCacheService.cacheImage(t.imagem,t.email);this.cachedImages[t.email]=e}}catch(t){console.error("Erro ao cacheiar imagens:",t)}})}getImageUrl(t){let e=this.cachedImages[t.email];return e&&!e.includes("null")?e:t.imagem}buscarParticipante(t=null){return c(this,null,function*(){try{let e=yield this.cospobreService.buscarParticipante(this.edicao,this.isCosplay).toPromise();console.log(e),this.listaParticipantes=e}catch(e){console.error("Erro ao buscar participantes:",e)}finally{t?.target&&t.target.complete()}})}buscarEdicao(){return c(this,null,function*(){try{let t=yield this.inscritosService.buscarEdicao().toPromise();console.log(t),this.edicao=t.numero}catch(t){console.error("Erro ao buscar edi\xE7\xE3o:",t)}})}excluirParticipante(t,e){return c(this,null,function*(){if(!e)return;yield(yield this.alertController.create({header:"Confirmar Exclus\xE3o",message:`Deseja excluir o participante ${e.nome}?`,buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{t.close()}},{text:"Excluir",role:"destructive",handler:()=>{this.confirmarExclusao(e)}}]})).present()})}toggleAudio(t,e){let i=this.players[t];if(!i){let n=new Audio(e);i={audio:n,isPlaying:!1,posicao:0},this.players[t]=i,n.onended=()=>{i.isPlaying=!1,i.posicao=0}}i.isPlaying?(i.posicao=i.audio.currentTime,i.audio.pause(),i.isPlaying=!1):(i.audio.currentTime=i.posicao,i.audio.play(),i.isPlaying=!0)}pararAudio(t){let e=this.players[t];e&&(e.audio.pause(),e.audio.currentTime=0,e.posicao=0,e.isPlaying=!1)}abrirParticipante(t){this.router.navigate(["/tabs/participante",this.edicao,t.id])}confirmarExclusao(t){return c(this,null,function*(){t&&this.cospobreService.deletarParticipante(t,this.edicao).subscribe({next:e=>{console.log("Inscrito exclu\xEDdo:",e),this.presentToast("Inscrito exclu\xEDdo com sucesso!","success"),this.init().then(()=>{this.cdr.detectChanges()})},error:e=>{console.error("Erro ao excluir inscrito:",e),this.presentToast("Erro ao excluir inscrito","danger")}})})}presentToast(t,e){return c(this,null,function*(){yield(yield this.toastController.create({message:t,color:e,duration:2e3})).present()})}};r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=O({type:r,selectors:[["app-tab3"]],decls:10,vars:5,consts:[["slidingItem",""],[1,"ion-no-border",3,"translucent"],["color","cuscuz"],["color","cuscuz-preto",1,"ion-text-left"],[1,"custom-title"],["color","cuscuz",3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["pullingIcon","arrow-down-outline","refreshingSpinner","crescent","pullingText","Puxe para atualizar","refreshingText","Atualizando..."],["class","loading-container ion-padding ion-text-center",4,"ngIf"],["class","lista-cospobre",4,"ngIf"],[1,"loading-container","ion-padding","ion-text-center"],["name","crescent"],[1,"lista-cospobre"],["class","cospobre-item-sliding",4,"ngFor","ngForOf"],[1,"cospobre-item-sliding"],["lines","full",1,"cospobre-item",3,"click"],["slot","start",3,"click"],[3,"src","alt"],[1,"ion-text-wrap"],[1,"audio-controls"],["size","small","fill","clear",3,"click"],[3,"name"],["name","stop"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash"]],template:function(e,i){e&1&&(p(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-title",3)(3,"ion-text",4),w(4),m()()()(),p(5,"ion-content",5)(6,"ion-refresher",6),C("ionRefresh",function(s){return i.buscarParticipante(s)}),y(7,"ion-refresher-content",7),m(),E(8,ge,4,0,"div",8)(9,fe,2,1,"ion-list",9),m()),e&2&&(f("translucent",!0),d(4),P(i.titulo),d(),f("fullscreen",!1),d(3),f("ngIf",i.isLoading),d(),f("ngIf",i.listaParticipantes))},dependencies:[R,z,$,U,j,B,ie,te,L,H,G,N,re,Y,J,ee,q,Z,W,X,K,Q],styles:[".audio-controls[_ngcontent-%COMP%]{display:flex;gap:4px}ion-thumbnail[_ngcontent-%COMP%]{cursor:pointer;--size: 60px}ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;object-fit:cover}ion-item-options[_ngcontent-%COMP%]{color:var(--ion-color-dark)}.custom-title[_ngcontent-%COMP%]{font-size:clamp(1rem,10vw,2rem);font-weight:700;letter-spacing:-2px;margin-top:75px;margin-left:10px;white-space:nowrap;text-overflow:clip;line-height:1;display:inline-block}ion-item.cospobre-item[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;width:90%}ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-medium)}ion-item[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px}ion-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center}ion-content[_ngcontent-%COMP%]   .no-participants[_ngcontent-%COMP%]{padding:40px 20px;text-align:center;color:var(--ion-color-medium)}@media (prefers-color-scheme: dark){ion-header[_ngcontent-%COMP%]{background:var(--ion-color-cuscuz-preto)}ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-cuscuz-preto) !important}ion-item-options[_ngcontent-%COMP%]{color:var(--ion-color-light)!important}ion-title[_ngcontent-%COMP%]{color:#fff}ion-icon[_ngcontent-%COMP%]{color:#fff}ion-list.lista-cospobre[_ngcontent-%COMP%]{background:var(--ion-color-cuscuz-preto)!important}ion-list.lista-cospobre[_ngcontent-%COMP%]   ion-item-sliding.cospobre-item-sliding[_ngcontent-%COMP%]{--background: var(--ion-color-cuscuz-preto) !important}ion-item.cospobre-item[_ngcontent-%COMP%]{--background: var(--ion-color-cuscuz-preto) !important;color:#fff}p[_ngcontent-%COMP%]{color:#fff}ion-refresher[_ngcontent-%COMP%]{background:var(--ion-color-cuscuz-preto)!important}}"]});let o=r;return o})();export{De as Tab3Page};
