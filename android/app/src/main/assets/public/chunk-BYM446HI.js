import{a as ce,b as de}from"./chunk-77ZGE33G.js";import{a as le}from"./chunk-MONBQXQC.js";import{a as me}from"./chunk-NR3X75IR.js";import"./chunk-HAS3KYMH.js";import"./chunk-QUJFQN2Y.js";import"./chunk-74VVU35J.js";import"./chunk-STHAPO56.js";import"./chunk-E42DNJ2K.js";import"./chunk-55XXYEDJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-SAPDOYEL.js";import"./chunk-C3LL2I4Y.js";import"./chunk-S4HFVOIW.js";import"./chunk-6TCBRD4K.js";import"./chunk-IEHZV7WG.js";import"./chunk-CKP3SGE2.js";import{A as u,Bb as ae,Ca as Y,Cb as se,D as l,Da as H,E as r,Ea as L,F as o,Fa as J,G as v,Ga as K,K as b,L as P,M as g,Q as O,R as T,S as F,T as k,U as z,V as d,W as V,aa as q,ea as R,eb as W,fb as X,ga as G,gb as Z,k as p,kb as ee,la as D,m as h,n as C,na as $,ob as te,r as I,rb as ne,s as M,ta as m,tb as ie,u as s,ua as B,va as Q,vb as oe,x as w,xa as U,ya as j,za as A,zb as re}from"./chunk-SXNL5ZVY.js";import"./chunk-UAS5NDXO.js";import"./chunk-4VLSKOYD.js";import"./chunk-FHBBBGIQ.js";import"./chunk-MGXTGIWY.js";import"./chunk-77S4VQ5A.js";import"./chunk-NY5B3PCS.js";import"./chunk-XWEC3AQS.js";import"./chunk-73IIU4GO.js";import"./chunk-U6X5N3E5.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-NMPY7VJP.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{f as _}from"./chunk-S5EYVFES.js";var _e=["imageContainer"];function ve(n,a){if(n&1){let e=b();r(0,"div",9)(1,"span",10),P("click",function(){h(e);let i=g();return C(i.cadastroNotas())}),d(2," Salvar "),o()()}}function xe(n,a){n&1&&(r(0,"small"),d(1,"Criatividade \xE9 obrigat\xF3ria"),o())}function he(n,a){n&1&&(r(0,"small"),d(1,"Nota deve ser entre 0 e 10"),o())}function Ce(n,a){n&1&&(r(0,"small"),d(1,"Use formato v\xE1lido (ex: 7.5)"),o())}function Pe(n,a){if(n&1&&(r(0,"ion-item",23)(1,"ion-text",24),u(2,xe,2,0,"small",25)(3,he,2,0,"small",25)(4,Ce,2,0,"small",25),o()()),n&2){let e=g(2);s(2),l("ngIf",e.errorControl.criatividade.errors==null?null:e.errorControl.criatividade.errors.required),s(),l("ngIf",(e.errorControl.criatividade.errors==null?null:e.errorControl.criatividade.errors.min)||(e.errorControl.criatividade.errors==null?null:e.errorControl.criatividade.errors.max)),s(),l("ngIf",e.errorControl.criatividade.errors==null?null:e.errorControl.criatividade.errors.pattern)}}function be(n,a){n&1&&(r(0,"small"),d(1,"Fidelidade \xE9 obrigat\xF3ria"),o())}function Ee(n,a){n&1&&(r(0,"small"),d(1,"Nota deve ser entre 0 e 10"),o())}function Se(n,a){n&1&&(r(0,"small"),d(1,"Use formato v\xE1lido (ex: 7.5)"),o())}function ye(n,a){if(n&1&&(r(0,"ion-item",23)(1,"ion-text",24),u(2,be,2,0,"small",25)(3,Ee,2,0,"small",25)(4,Se,2,0,"small",25),o()()),n&2){let e=g(2);s(2),l("ngIf",e.errorControl.fidelidade.errors==null?null:e.errorControl.fidelidade.errors.required),s(),l("ngIf",(e.errorControl.fidelidade.errors==null?null:e.errorControl.fidelidade.errors.min)||(e.errorControl.fidelidade.errors==null?null:e.errorControl.fidelidade.errors.max)),s(),l("ngIf",e.errorControl.fidelidade.errors==null?null:e.errorControl.fidelidade.errors.pattern)}}function Ne(n,a){n&1&&(r(0,"small"),d(1,"Desenvolvimento \xE9 obrigat\xF3rio"),o())}function Ie(n,a){n&1&&(r(0,"small"),d(1,"Nota deve ser entre 0 e 10"),o())}function Me(n,a){n&1&&(r(0,"small"),d(1,"Use formato v\xE1lido (ex: 7.5)"),o())}function we(n,a){if(n&1&&(r(0,"ion-item",23)(1,"ion-text",24),u(2,Ne,2,0,"small",25)(3,Ie,2,0,"small",25)(4,Me,2,0,"small",25),o()()),n&2){let e=g(2);s(2),l("ngIf",e.errorControl.desenvolvimento.errors==null?null:e.errorControl.desenvolvimento.errors.required),s(),l("ngIf",(e.errorControl.desenvolvimento.errors==null?null:e.errorControl.desenvolvimento.errors.min)||(e.errorControl.desenvolvimento.errors==null?null:e.errorControl.desenvolvimento.errors.max)),s(),l("ngIf",e.errorControl.desenvolvimento.errors==null?null:e.errorControl.desenvolvimento.errors.pattern)}}function Oe(n,a){if(n&1){let e=b();r(0,"div",11)(1,"div",12,1),P("click",function(){h(e);let i=g();return C(i.toggleImage())}),v(3,"img",13)(4,"div",14)(5,"ion-icon",15),o(),r(6,"form",16),P("ngSubmit",function(){h(e);let i=g();return C(i.cadastroNotas())}),r(7,"ion-item",17)(8,"ion-label",18),d(9,"Criatividade (0-10)"),o(),v(10,"ion-input",19),o(),u(11,Pe,5,3,"ion-item",20),r(12,"ion-item",17)(13,"ion-label",18),d(14,"Fidelidade (0-10)"),o(),v(15,"ion-input",21),o(),u(16,ye,5,3,"ion-item",20),r(17,"ion-item",17)(18,"ion-label",18),d(19,"Desenvolvimento (0-10)"),o(),v(20,"ion-input",22),o(),u(21,we,5,3,"ion-item",20),o()()}if(n&2){let e=g();s(),z("expanded",e.isExpanded),s(2),l("src",e.participante==null?null:e.participante.imagem,M)("alt",e.participante==null?null:e.participante.personagem),s(2),l("name",e.isExpanded?"chevron-up-outline":"chevron-down-outline"),s(),l("formGroup",e.formCadastroNotas),s(5),l("ngIf",e.errorControl.criatividade.invalid&&e.isSubmitted),s(5),l("ngIf",e.errorControl.fidelidade.invalid&&e.isSubmitted),s(5),l("ngIf",e.errorControl.desenvolvimento.invalid&&e.isSubmitted)}}function Te(n,a){n&1&&(r(0,"div",26),v(1,"ion-spinner",27),r(2,"p"),d(3,"Carregando..."),o()())}var Ye=(()=>{let a=class a{constructor(){this.formBuilder=p(H),this.notasService=p(ce),this.cospobreService=p(de),this.inscritosService=p(le),this.toastController=p(re),this.router=p($),this.platform=p(K),this.gestureCtrl=p(me),this.route=p(D),this.isSubmitted=!1,this.isExpanded=!1,this.listaNotas=[],this.isCarregandoParticipante=!0,this.platform.ready().then(()=>{this.init()})}get errorControl(){return this.formCadastroNotas.controls}ngAfterViewInit(){setTimeout(()=>{this.imageContainer?.nativeElement&&this.initializeGesture()},50)}ngOnInit(){this.route.paramMap.subscribe(t=>{let i=t.get("edicao"),c=t.get("id");i!==null&&c!==null&&this.carregarParticipante(parseInt(i),parseInt(c))}),this.formCadastroNotas=this.formBuilder.group({criatividade:["",[m.required,m.pattern(/^10$|^[0-9](\.[0-9]{1,2})?$/),m.min(0),m.max(10)]],fidelidade:["",[m.required,m.pattern(/^10$|^[0-9](\.[0-9]{1,2})?$/),m.min(0),m.max(10)]],desenvolvimento:["",[m.required,m.pattern(/^10$|^[0-9](\.[0-9]{1,2})?$/),m.min(0),m.max(10)]]})}init(){return _(this,null,function*(){try{yield this.buscarEdicao(),yield this.buscarNotas()}catch(t){console.error("Erro ao inicializar dados:",t)}})}carregarParticipante(t,i){return _(this,null,function*(){this.isCarregandoParticipante=!0,this.participante=yield this.cospobreService.buscarParticipanteById(t,i).toPromise(),this.isCarregandoParticipante=!1})}buscarEdicao(){return _(this,null,function*(){try{let t=yield this.inscritosService.buscarEdicao().toPromise();console.log(t),this.edicao=t.numero}catch(t){console.error("Erro ao buscar edi\xE7\xE3o:",t)}})}buscarNotas(){return _(this,null,function*(){return new Promise((t,i)=>{console.log("Buscando notas para edi\xE7\xE3o:",this.edicao),this.notasService.buscarNotas(this.edicao,!0).subscribe({next:c=>{console.log("Notas recebidas do servidor:",c),this.listaNotas=c||[],t()},error:c=>{console.error("Erro ao buscar notas:",c),this.listaNotas=[],this.presentToast("Erro ao carregar notas","danger"),i(c)}})})})}cadastroNotas(){if(this.isSubmitted=!0,!this.formCadastroNotas.valid){this.presentToast("Por favor, preencha as notas corretamente","danger");return}console.log(this.formCadastroNotas.value);try{let t=this.listaNotas.find(x=>x.cospobreId===this.participante.id);if(console.log(this.listaNotas),!t){this.presentToast("Erro: Participante n\xE3o encontrado nas notas","danger");return}console.log(this.participante.nome);let i=this.parseSafeFloat(t.nota_1),c=this.parseSafeFloat(t.nota_2),f=this.parseSafeFloat(t.nota_3),pe=this.parseSafeFloat(this.formCadastroNotas.value.criatividade),ue=this.parseSafeFloat(this.formCadastroNotas.value.fidelidade),ge=this.parseSafeFloat(this.formCadastroNotas.value.desenvolvimento),E=i+pe,S=c+ue,y=f+ge,fe=(E+S+y)/3,N={id:t.id,nome:t.nome,personagem:t.personagem,edicao:t.edicao,nota_1:E.toFixed(2),nota_2:S.toFixed(2),nota_3:y.toFixed(2),total_nota:fe.toFixed(2)};console.log("\u{1F4E4} Dados para envio:",N),this.notasService.atualizarNotas(N,this.edicao,!0).subscribe({next:x=>{console.log("\u2705 Resposta do servidor:",x),this.presentToast("Notas Cadastradas Com Sucesso","success"),this.formCadastroNotas.reset(),this.isSubmitted=!1},error:x=>{console.error("\u274C Erro no cadastro de notas:",x),this.presentToast("Erro ao cadastrar notas. Tente novamente.","danger")}}),this.presentToast("Notas Cadastradas Com Sucesso","success"),this.router.navigate(["/tabs/tab3"])}catch(t){console.error("Erro ao cadastrar as notas:",t),this.presentToast("Erro ao cadastrar as notas","danger")}}toggleImage(){this.isExpanded=!this.isExpanded}initializeGesture(){if(!this.imageContainer?.nativeElement)return;this.gestureCtrl.create({el:this.imageContainer.nativeElement,gestureName:"swipe-image",threshold:15,direction:"y",gesturePriority:100,onEnd:i=>{i.deltaY>50&&!this.isExpanded?this.isExpanded=!0:i.deltaY<-50&&this.isExpanded&&(this.isExpanded=!1)}}).enable(!0)}presentToast(t,i){return _(this,null,function*(){yield(yield this.toastController.create({message:t,color:i,duration:2e3})).present()})}parseSafeFloat(t){if(t==null||t==="")return 0;let i=parseFloat(t);return isNaN(i)?0:i}};a.\u0275fac=function(i){return new(i||a)},a.\u0275cmp=w({type:a,selectors:[["app-participante"]],viewQuery:function(i,c){if(i&1&&O(_e,5,I),i&2){let f;T(f=F())&&(c.imageContainer=f.first)}},decls:10,vars:6,consts:[["loading",""],["imageContainer",""],[1,"ion-no-border",3,"translucent"],["color","cuscuz"],["color","cuscuz-preto",1,"ion-text-left"],[1,"custom-title"],["slot","end","class","salvar-container",4,"ngIf"],[3,"fullscreen"],["class","content",4,"ngIf","ngIfElse"],["slot","end",1,"salvar-container"],[1,"salvar-text",3,"click"],[1,"content"],[1,"cospobre-image-container",3,"click"],[1,"cospobre-image",3,"src","alt"],[1,"expand-bar"],[1,"expand-icon",3,"name"],["novalidate","","id","formNotas",3,"ngSubmit","formGroup"],["lines","full",1,"ion-no-padding"],["position","floating"],["clear-input","true","required","","type","number","step","0.1","min","0","max","10","formControlName","criatividade"],["lines","none",4,"ngIf"],["clear-input","true","required","","type","number","step","0.1","min","0","max","10","formControlName","fidelidade"],["clear-input","true","required","","type","number","step","0.1","min","0","max","10","formControlName","desenvolvimento"],["lines","none"],["color","danger"],[4,"ngIf"],[1,"loading-container"],["name","crescent"]],template:function(i,c){if(i&1&&(r(0,"ion-header",2)(1,"ion-toolbar",3)(2,"ion-title",4)(3,"ion-text",5),d(4),o()(),u(5,ve,3,0,"div",6),o()(),r(6,"ion-content",7),u(7,Oe,22,9,"div",8)(8,Te,4,0,"ng-template",null,0,q),o()),i&2){let f=k(9);l("translucent",!0),s(4),V(c.participante==null?null:c.participante.personagem),s(),l("ngIf",c.participante),s(),l("fullscreen",!1),s(),l("ngIf",c.participante)("ngIfElse",f)}},dependencies:[G,R,L,U,B,Q,Y,J,j,A,X,oe,ie,W,Z,ee,se,ne,ae,te],styles:['.cospobre-image-container[_ngcontent-%COMP%]{width:100%;max-height:100px;overflow:hidden;position:relative;transition:max-height .4s ease;cursor:pointer}.cospobre-image-container.expanded[_ngcontent-%COMP%]{max-height:500px}.cospobre-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:cover;display:block}.cospobre-image-container[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;right:0;bottom:0;height:36px;background:linear-gradient(to top,rgba(0,0,0,.8),transparent);pointer-events:none;z-index:1}.cospobre-image-container[_ngcontent-%COMP%]   .expand-icon[_ngcontent-%COMP%]{position:absolute;bottom:6px;left:50%;transform:translate(-50%);font-size:28px;color:#fff;transition:all .4s ease;pointer-events:none;z-index:2;transition:transform .3s ease}.cospobre-image-container.expanded[_ngcontent-%COMP%]   .expand-icon[_ngcontent-%COMP%]{transform:translate(-50%) rotate(180deg)}.custom-title[_ngcontent-%COMP%]{font-size:clamp(1rem,10vw,2rem);font-weight:700;letter-spacing:-2px;margin-top:75px;margin-left:10px;text-overflow:clip;line-height:1.2;display:block;white-space:normal;word-break:break-word}.salvar-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:75px;margin-left:10px;height:44px;padding:0 16px}.salvar-container[_ngcontent-%COMP%]   .salvar-text[_ngcontent-%COMP%]{color:#758fff;font-size:20px;font-weight:500;cursor:pointer;line-height:44px;height:44px;padding:0 8px}.salvar-container[_ngcontent-%COMP%]   .salvar-text[_ngcontent-%COMP%]:hover:not(.disabled){color:var(--ion-color-primary)}.salvar-container[_ngcontent-%COMP%]   .salvar-text.disabled[_ngcontent-%COMP%]{color:#ffffff80;cursor:not-allowed;opacity:.6}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;text-align:center;height:100%}.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:40px;height:40px;margin-bottom:16px;--color: var(--ion-color-cuscuz-preto)}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-top:12px;font-size:14px;text-align:center}.content[_ngcontent-%COMP%]{padding:20px;background:#fff;font-weight:700;text-align:center;height:50vh}.content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:var(--ion-color-dark);font-size:1.2rem;font-weight:700!important}form[_ngcontent-%COMP%]{background:#fff;margin-top:20px}ion-item[_ngcontent-%COMP%]{--border-color: rgba(0, 0, 0, .2);--background: white;--color: black}@media (prefers-color-scheme: dark){.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{--color: white}ion-header[_ngcontent-%COMP%]{background:var(--ion-color-cuscuz-preto)}ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-cuscuz-preto) !important}ion-title[_ngcontent-%COMP%]{color:#fff}.content[_ngcontent-%COMP%]{background:var(--ion-color-cuscuz-preto)!important}.content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{color:#fff}form[_ngcontent-%COMP%]{background:var(--ion-color-cuscuz-preto)!important}ion-item[_ngcontent-%COMP%]{--border-color: rgba(255, 255, 255, .2);--background: var(--ion-color-cuscuz-preto) !important;--color: white}}']});let n=a;return n})();export{Ye as ParticipantePage};
