<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar color="cuscuz">
    <ion-title class="ion-text-left" color="cuscuz-preto">
      <ion-text class="custom-title">{{ participante?.personagem }}</ion-text>
    </ion-title>

    <div slot="end" class="salvar-container" *ngIf="participante">
      <span
        (click)="cadastroNotas()"
        class="salvar-text">
        Salvar
      </span>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="false">
  <div class="content" *ngIf="participante; else loading">
    <div
      #imageContainer
      class="cospobre-image-container"
      [class.expanded]="isExpanded"
      (click)="toggleImage()">
      <img
        [src]="participante?.imagem"
        [alt]="participante?.personagem"
        class="cospobre-image" />

      <div class="expand-bar"></div>

      <ion-icon
        [name]="isExpanded ? 'chevron-up-outline' : 'chevron-down-outline'"
        class="expand-icon">
      </ion-icon>
    </div>

    <form [formGroup]="formCadastroNotas"
      (ngSubmit)="cadastroNotas()"
      novalidate
      id="formNotas">

      <ion-item lines="full" class="ion-no-padding">
        <ion-label position="floating">Criatividade (0-10)</ion-label>
        <ion-input
          clear-input="true"
          required
          type="number"
          step="0.1"
          min="0"
          max="10"
          formControlName="criatividade">
        </ion-input>
      </ion-item>

      <ion-item *ngIf="errorControl['criatividade'].invalid && isSubmitted" lines="none">
        <ion-text color="danger">
          <small *ngIf="errorControl['criatividade'].errors?.['required']">Criatividade é obrigatória</small>
          <small *ngIf="errorControl['criatividade'].errors?.['min'] || errorControl['criatividade'].errors?.['max']">Nota deve ser entre 0 e 10</small>
          <small *ngIf="errorControl['criatividade'].errors?.['pattern']">Use formato válido (ex: 7.5)</small>
        </ion-text>
      </ion-item>

      <ion-item lines="full" class="ion-no-padding">
        <ion-label position="floating">Fidelidade (0-10)</ion-label>
        <ion-input
          clear-input="true"
          required
          type="number"
          step="0.1"
          min="0"
          max="10"
          formControlName="fidelidade">
        </ion-input>
      </ion-item>

      <ion-item *ngIf="errorControl['fidelidade'].invalid && isSubmitted" lines="none">
        <ion-text color="danger">
          <small *ngIf="errorControl['fidelidade'].errors?.['required']">Fidelidade é obrigatória</small>
          <small *ngIf="errorControl['fidelidade'].errors?.['min'] || errorControl['fidelidade'].errors?.['max']">Nota deve ser entre 0 e 10</small>
          <small *ngIf="errorControl['fidelidade'].errors?.['pattern']">Use formato válido (ex: 7.5)</small>
        </ion-text>
      </ion-item>

      <ion-item lines="full" class="ion-no-padding">
        <ion-label position="floating">Desenvolvimento (0-10)</ion-label>
        <ion-input
          clear-input="true"
          required
          type="number"
          step="0.1"
          min="0"
          max="10"
          formControlName="desenvolvimento">
        </ion-input>
      </ion-item>

      <ion-item *ngIf="errorControl['desenvolvimento'].invalid && isSubmitted" lines="none">
        <ion-text color="danger">
          <small *ngIf="errorControl['desenvolvimento'].errors?.['required']">Desenvolvimento é obrigatório</small>
          <small *ngIf="errorControl['desenvolvimento'].errors?.['min'] || errorControl['desenvolvimento'].errors?.['max']">Nota deve ser entre 0 e 10</small>
          <small *ngIf="errorControl['desenvolvimento'].errors?.['pattern']">Use formato válido (ex: 7.5)</small>
        </ion-text>
      </ion-item>
    </form>
  </div>

  <ng-template #loading>
    <div class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Carregando...</p>
    </div>
  </ng-template>
</ion-content>
