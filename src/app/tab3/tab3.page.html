<ion-header [translucent]="true">
  <ion-toolbar color="cuscuz-preto">
    <ion-title class="ion-text-center">
      <h1>Cospobres</h1>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" color="cuscuz">
  <ion-list *ngIf="listaParticipantes">

    <ion-item-sliding *ngFor="let participante of listaParticipantes">

      <ion-item lines="full">

        <ion-thumbnail slot="start" (click)="setModal(true, participante.personagem, participante.imagem, participante.nome)">
          <img [src]="getImageUrl(participante)" [alt]="participante.personagem" />
          <ion-modal [isOpen]="isModalOpen">
            <ng-template>
              <ion-header>
                <ion-toolbar>
                  <ion-title class="ion-text-center">Personagem</ion-title>
                  <ion-buttons slot="end">
                    <ion-button (click)="setModal(false)">Fechar</ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <ion-content class="ion-padding">
                <div class="modal-content">
                  <img [src]="imagem" [alt]="personagem" class="modal-image" />
                  <h1 style="text-align: center;">{{ personagem }}</h1>
                  <h2 style="text-align: center; color: #666;">{{ nome }}</h2>

                  <form [formGroup]="formCadastroNotas" (ngSubmit)="buscaNotasEAltera()" novalidate>

                    <ion-item lines="full" class="ion-no-padding">
                      <ion-label position="floating">Criatividade (0-10)</ion-label>
                      <ion-input
                        clear-input="true"
                        required
                        type="number"
                        step="0.1"
                        min="0"
                        max="10"
                        formControlName="criatividade">
                      </ion-input>
                    </ion-item>

                    <ion-item *ngIf="errorControl['criatividade'].invalid && isSubmitted" lines="none">
                      <ion-text color="danger">
                        <small *ngIf="errorControl['criatividade'].errors?.['required']">Criatividade é obrigatória</small>
                        <small *ngIf="errorControl['criatividade'].errors?.['min'] || errorControl['criatividade'].errors?.['max']">Nota deve ser entre 0 e 10</small>
                        <small *ngIf="errorControl['criatividade'].errors?.['pattern']">Use formato válido (ex: 7.5)</small>
                      </ion-text>
                    </ion-item>

                    <ion-item lines="full" class="ion-no-padding">
                      <ion-label position="floating">Fidelidade (0-10)</ion-label>
                      <ion-input
                        clear-input="true"
                        required
                        type="number"
                        step="0.1"
                        min="0"
                        max="10"
                        formControlName="fidelidade">
                      </ion-input>
                    </ion-item>

                    <ion-item *ngIf="errorControl['fidelidade'].invalid && isSubmitted" lines="none">
                      <ion-text color="danger">
                        <small *ngIf="errorControl['fidelidade'].errors?.['required']">Fidelidade é obrigatória</small>
                        <small *ngIf="errorControl['fidelidade'].errors?.['min'] || errorControl['fidelidade'].errors?.['max']">Nota deve ser entre 0 e 10</small>
                        <small *ngIf="errorControl['fidelidade'].errors?.['pattern']">Use formato válido (ex: 7.5)</small>
                      </ion-text>
                    </ion-item>

                    <ion-item lines="full" class="ion-no-padding">
                      <ion-label position="floating">Desenvolvimento (0-10)</ion-label>
                      <ion-input
                        clear-input="true"
                        required
                        type="number"
                        step="0.1"
                        min="0"
                        max="10"
                        formControlName="desenvolvimento">
                      </ion-input>
                    </ion-item>

                    <ion-item *ngIf="errorControl['desenvolvimento'].invalid && isSubmitted" lines="none">
                      <ion-text color="danger">
                        <small *ngIf="errorControl['desenvolvimento'].errors?.['required']">Desenvolvimento é obrigatório</small>
                        <small *ngIf="errorControl['desenvolvimento'].errors?.['min'] || errorControl['desenvolvimento'].errors?.['max']">Nota deve ser entre 0 e 10</small>
                        <small *ngIf="errorControl['desenvolvimento'].errors?.['pattern']">Use formato válido (ex: 7.5)</small>
                      </ion-text>
                    </ion-item>

                    <ion-button
                      expand="full"
                      fill="outline"
                      color="primary"
                      type="submit"
                      class="ion-margin-top">
                      Cadastrar Notas
                    </ion-button>

                  </form>
                </div>
              </ion-content>
            </ng-template>
          </ion-modal>
        </ion-thumbnail>

        <ion-label class="ion-text-wrap">
          <div>
            <h2>{{ participante.nome }}</h2>
            <p>{{ participante.personagem }}</p>
          </div>
        </ion-label>

        <div class="audio-controls">
          <ion-button size="small" (click)="reproduzirAudio(participante.som)" fill="clear">
            <ion-icon name="play"></ion-icon>
          </ion-button>
          <ion-button size="small" (click)="pausarAudio()" fill="clear">
            <ion-icon name="pause"></ion-icon>
          </ion-button>
          <ion-button size="small" (click)="pararAudio()" fill="clear">
            <ion-icon name="stop"></ion-icon>
          </ion-button>
        </div>

      </ion-item>

    </ion-item-sliding>

  </ion-list>

  <div *ngIf="!listaParticipantes || listaParticipantes.length === 0" class="ion-padding ion-text-center">
    <ion-text color="medium">
      <p>Nenhum participante encontrado</p>
    </ion-text>
  </div>

</ion-content>
